import{_ as t,c as r,C as s,a,I as o,E as e,V as l,J as c,o as i}from"./chunks/framework.2c88e6e5.js";const p="/flame-blog/img/platform/xyd_sign_estxid.png",C="/flame-blog/img/platform/xyd_socket.png",d="/flame-blog/img/platform/xyd_trace_log.png",_="/flame-blog/img/platform/xyd_debug255.png",y="/flame-blog/img/platform/xyd_pos_trans_req.png",m="/flame-blog/img/platform/xyd_unpack_error.png",g="/flame-blog/img/platform/xyd_unpack_tpdu.png",b="/flame-blog/img/platform/xyd_ls_a.png",D="/flame-blog/img/platform/xyd_mk_stopping.png",h="/flame-blog/img/platform/xyd_sign_error.png",u="/flame-blog/img/platform/xyd_sign_msghead.png",A="/flame-blog/img/platform/xyd_java_font.png",f="/flame-blog/img/platform/xyd_sw_commfun.png",F="/flame-blog/img/platform/xyd_ct_to_zz.png",x="/flame-blog/img/platform/xyd_pos96.png",P="/flame-blog/img/platform/xyd_ibs_long.png",E="/flame-blog/img/platform/xyd_mac_off.png",q="/flame-blog/img/platform/xyd_posp_error.png",T="/flame-blog/img/platform/xyd_mac_alg0.png",k="/flame-blog/img/platform/xyd_ic_card.png",U=JSON.parse('{"title":"新一代常见开发问题","description":"","frontmatter":{},"headers":[],"relativePath":"platform/xyd/common-problem.md","filePath":"platform/xyd/common-problem.md"}'),S={name:"platform/xyd/common-problem.md"},v=l('<h1 id="新一代常见开发问题" tabindex="-1">新一代常见开发问题 <a class="header-anchor" href="#新一代常见开发问题" aria-label="Permalink to &quot;新一代常见开发问题&quot;">​</a></h1><h2 id="_1-签到无法识别交易类型-estxnid表" tabindex="-1">（1）签到无法识别交易类型（estxnID表） <a class="header-anchor" href="#_1-签到无法识别交易类型-estxnid表" aria-label="Permalink to &quot;（1）签到无法识别交易类型（estxnID表）&quot;">​</a></h2><img src="'+p+`" data-fancybox="gallery"><p>表:estxnid <br><strong>用途</strong>：交易信息配置表，用于平台匹配交易类型 ，通过这些条件唯一确定一笔交易类型。 <br><strong>原则</strong>：消费类：1域+3域+25域+60.1域 管理类：1域+25域+60.3域</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> estxnID </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> msg_type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0800</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>交易未配置： 交易代码表esTxnID</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">insert into</span><span style="color:#A6ACCD;"> esTxnID (APPL_ID, TXN_ID, MSG_TYPE, COND_CODE, FUNC_CODE, PROC_CODE, TXN_NAME, REQ_MIN_BITMAP, REQ_MAX_BITMAP, REJECT_BITMAP, ACK_BITMAP, CK_REQ_BITMAP, MAC_FLAG, VOID_FLAG, ORG_TXN_ID, REV_ORG_MSG_TYPE, REC_FLAG, DUP_HANDLE, ERR_HANDLE, SETT_FLAG, MCH_ACCU, CASHIER_ACCU, LOT_FLAG, BUSINESS_TYPE)</span></span>
<span class="line"><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">2166</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0200</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">81</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">23</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">780000</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">账单缴费撤销</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">702404C030C19801</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">702404C030C19801</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">703E00800EC18001</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">703E00800EC18001</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">null</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">null</span><span style="color:#A6ACCD;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>交易配置表 estrancfg</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">insert into</span><span style="color:#A6ACCD;"> estrancfg (DEVICENO, ETSTRANCODE, TRANSTEP, CONTENT)</span></span>
<span class="line"><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0002</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">020078</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0502</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">撤销交易请求</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_2-监控上显示-estxnid表中插入的" tabindex="-1">（2）监控上显示？？？（estxnid表中插入的） <a class="header-anchor" href="#_2-监控上显示-estxnid表中插入的" aria-label="Permalink to &quot;（2）监控上显示？？？（estxnid表中插入的）&quot;">​</a></h2><img src="`+p+'" data-fancybox="gallery"><p><a href="https://jingyan.baidu.com/article/fec7a1e5b263f61190b4e732.html" target="_blank" rel="noreferrer">更改环境变量</a></p><ul><li>在“系统变量”中新建环境变量，变量名为：NLS_LANG 变量值为：AMERICAN_AMERICA.ZHS16GBK ，然后确定即可。</li><li>接着在&quot;系统变量&quot;中再新建一个环境变量，变量名为：LANG 变量值为：zh_CN.GBK 然后确定。</li></ul><h2 id="_3-tcp-udp-socket调试工具" tabindex="-1">（3）TCP/UDP Socket调试工具 <a class="header-anchor" href="#_3-tcp-udp-socket调试工具" aria-label="Permalink to &quot;（3）TCP/UDP Socket调试工具&quot;">​</a></h2><p>显示十六进制值发送</p><img src="'+C+'" data-fancybox="gallery"><h2 id="_4-tranlist-debug找不到日志" tabindex="-1">（4）tranlist.debug找不到日志 <a class="header-anchor" href="#_4-tranlist-debug找不到日志" aria-label="Permalink to &quot;（4）tranlist.debug找不到日志&quot;">​</a></h2><p>监控上有显示，但是tranlist.debug中找不到该交易的日志,解决方法：</p><ol><li>trace_log0314中有没有该笔交易</li></ol><img src="'+d+'" data-fancybox="gallery"><ol start="2"><li>posTranReq.debug255找到以下字段 nbcsa/home/nttnb_run/log/debug&gt; <strong>view ./posTranReq.debug255</strong></li></ol><img src="'+_+'" data-fancybox="gallery"><ol start="3"><li>然后就可以进入该笔交易的日志</li></ol><img src="'+y+'" data-fancybox="gallery"><p>16为交易时间，1220842为<strong>posTranReq.debug255</strong>查找出来的</p><h2 id="_5-unpack解包失败-pin中日志" tabindex="-1">（5）UNPACK解包失败（pin中日志） <a class="header-anchor" href="#_5-unpack解包失败-pin中日志" aria-label="Permalink to &quot;（5）UNPACK解包失败（pin中日志）&quot;">​</a></h2><img src="'+m+'" data-fancybox="gallery"><p>TPDU的原因，发到传统了，需要ULINK那边添加，或者生产上用的测试的tpdu。</p><img src="'+g+'" data-fancybox="gallery">',29),I=l('<h2 id="_6-邮箱绑定失败-ibsrun-bin" tabindex="-1">（6）邮箱绑定失败（ibsrun/bin） <a class="header-anchor" href="#_6-邮箱绑定失败-ibsrun-bin" aria-label="Permalink to &quot;（6）邮箱绑定失败（ibsrun/bin）&quot;">​</a></h2><p>清除ibsrun/bin中的.IBS_VAR_4X下所有文件和._IBS_SYSTEM_LOCK。 <strong>ls -a可以显示.IBS_VAR_4X和._IBS_SYSTEM_LOCK</strong>。</p><img src="'+b+'" data-fancybox="gallery"><p>216上mk.sh的时候出现STOPPING 可能是136山中间脚本邮箱未起来，不出现ibsComp.log，可能是脚本里面报错。</p><img src="'+D+'" data-fancybox="gallery"><h2 id="_7-签到失败可能原因" tabindex="-1">（7）签到失败可能原因 <a class="header-anchor" href="#_7-签到失败可能原因" aria-label="Permalink to &quot;（7）签到失败可能原因&quot;">​</a></h2><img src="'+h+'" data-fancybox="gallery"><p>可能原因：MSGHEAD不对。</p><img src="'+u+'" data-fancybox="gallery"><h2 id="_8-java前置更改长度" tabindex="-1">（8）java前置更改长度 <a class="header-anchor" href="#_8-java前置更改长度" aria-label="Permalink to &quot;（8）java前置更改长度&quot;">​</a></h2><p>config中的applicationContext .xml中修改。</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>注意：通讯程序中对应的长度也要进行修改</p></div><img src="'+A+'" data-fancybox="gallery"><h2 id="_9-后线发对账通知" tabindex="-1">（9）后线发对账通知 <a class="header-anchor" href="#_9-后线发对账通知" aria-label="Permalink to &quot;（9）后线发对账通知&quot;">​</a></h2><p>swCommfun.c中switch修改为dbsvr</p><img src="'+f+'" data-fancybox="gallery"><h2 id="_10-传统改增值-以山东为例" tabindex="-1">（10）传统改增值（以山东为例） <a class="header-anchor" href="#_10-传统改增值-以山东为例" aria-label="Permalink to &quot;（10）传统改增值（以山东为例）&quot;">​</a></h2><ul><li>签到要用增值签到，签到之后将estpduinfo中tpdu对应的appl_id改为传统1</li><li>签到（0800003）的时候需要修改增值对应的路由脚本215.SCR，让其走增值。</li></ul><img src="'+F+'" data-fancybox="gallery"><h2 id="_11-仿真00-终端96" tabindex="-1">（11）仿真00 终端96 <a class="header-anchor" href="#_11-仿真00-终端96" aria-label="Permalink to &quot;（11）仿真00  终端96&quot;">​</a></h2><p>仿真返00 终端96 ：<strong>hsm_tmk表未配置 ，62域未解析出来</strong>。</p><p>136青岛中修改格式转换组2012.FMT如下图所示。</p><img src="'+x+'" data-fancybox="gallery">',23),N=s("strong",null,"调用安全模块保存密钥出错HsmKeyUpdate",-1),R=l('<h2 id="_12-中间业务脚本变量名称太长-底层写的不能超过20位" tabindex="-1">（12）中间业务脚本变量名称太长（底层写的不能超过20位） <a class="header-anchor" href="#_12-中间业务脚本变量名称太长-底层写的不能超过20位" aria-label="Permalink to &quot;（12）中间业务脚本变量名称太长（底层写的不能超过20位）&quot;">​</a></h2><p><strong>测试中19位就报下面错误</strong></p><img src="'+P+`" data-fancybox="gallery"><h2 id="_13-签到" tabindex="-1">（13）签到 <a class="header-anchor" href="#_13-签到" aria-label="Permalink to &quot;（13）签到&quot;">​</a></h2><ol><li>签到后发交易返A0H，签到去的地方不对，看看签到日志中的路由。 53——本地 42/470<br></li><li>签到和发交易都返96L,平台errlog中SQL error -14400。fjnl、espostrn、estrnlog未建分区。 <strong>建分区:</strong></li></ol><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">alter</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> ESTRNLOG </span><span style="color:#F78C6C;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">Partition</span><span style="color:#A6ACCD;"> ESTRNLOG_P20201230 </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">20201230</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#F78C6C;">alter</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">table</span><span style="color:#A6ACCD;"> ESTRNLOG </span><span style="color:#F78C6C;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">Partition</span><span style="color:#A6ACCD;"> ESTRNLOG_P20201231 </span><span style="color:#F78C6C;">values</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">20201231</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_14-关闭mac校验" tabindex="-1">（14）关闭MAC校验 <a class="header-anchor" href="#_14-关闭mac校验" aria-label="Permalink to &quot;（14）关闭MAC校验&quot;">​</a></h2><p>estidinfo中的MAC_ALG设置为0</p><img src="`+E+'" data-fancybox="gallery"><h2 id="_15-posp解包错误" tabindex="-1">（15）POSP解包错误 <a class="header-anchor" href="#_15-posp解包错误" aria-label="Permalink to &quot;（15）POSP解包错误&quot;">​</a></h2><p>看pin中那个域解包错误，看是不是par包对应格式有问题，或者<strong>tpdu</strong>用错（改下estpduinfo表，对应的1改成2增值）</p><img src="'+q+'" data-fancybox="gallery"><h2 id="_16-内容输出" tabindex="-1">（16）内容输出 <a class="header-anchor" href="#_16-内容输出" aria-label="Permalink to &quot;（16）内容输出&quot;">​</a></h2><p>estidinfo表的MAC_ALG设置为0，终端分组为PSZ。</p><img src="'+T+`" data-fancybox="gallery"><h2 id="_17-ftp的密码设置" tabindex="-1">（17）ftp的密码设置 <a class="header-anchor" href="#_17-ftp的密码设置" aria-label="Permalink to &quot;（17）ftp的密码设置&quot;">​</a></h2><p>FTPPWD=123456$1234 设置密码的时候有$符号会被过滤，需要加上单引号FTPPWD=&#39;123456$1234&#39;。</p><h2 id="_18-更改密码" tabindex="-1">（18）更改密码 <a class="header-anchor" href="#_18-更改密码" aria-label="Permalink to &quot;（18）更改密码&quot;">​</a></h2><ul><li>数据库解锁：</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">alter</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">user</span><span style="color:#A6ACCD;"> ntthb_run account </span><span style="color:#F78C6C;">unlock</span><span style="color:#A6ACCD;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>数据库执行：</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">alter</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">user</span><span style="color:#A6ACCD;"> ntthe_run identified </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> Ntthe_136;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>应用修改：</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">view</span><span style="color:#A6ACCD;"> $HOME</span><span style="color:#C3E88D;">/.bash_profile</span></span>
<span class="line"><span style="color:#FFCB6B;">view</span><span style="color:#A6ACCD;"> $HOME</span><span style="color:#C3E88D;">/ibsrun/ini/ibs_ifcfg.ini</span></span>
<span class="line"><span style="color:#FFCB6B;">hsmdbu</span><span style="color:#A6ACCD;"> $SWITCH_DBUSER $SWITCH_DBPASS</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_19-撤销返回25h" tabindex="-1">（19）撤销返回25H <a class="header-anchor" href="#_19-撤销返回25h" aria-label="Permalink to &quot;（19）撤销返回25H&quot;">​</a></h2><p>37域和61域以外，60域后面也需要和缴费相同。缴费送22000003000<strong>60</strong>，撤销送2300000300050时候会报25H，送跟缴费一样则成功。</p><p>缴费有返回38域授权码，撤销未上送38域授权码。</p><h2 id="_20-tc值上送" tabindex="-1">（20）TC值上送 <a class="header-anchor" href="#_20-tc值上送" aria-label="Permalink to &quot;（20）TC值上送&quot;">​</a></h2><p>青海不送48域时，62域和63域中间业务脚本没有进行交换，让终端62域送值，63域不送值。</p><h2 id="_21-卡组织代码和ic卡参数下载63域返0" tabindex="-1">（21）卡组织代码和IC卡参数下载63域返0 <a class="header-anchor" href="#_21-卡组织代码和ic卡参数下载63域返0" aria-label="Permalink to &quot;（21）卡组织代码和IC卡参数下载63域返0&quot;">​</a></h2><p>卡组织代码缴费63域返回CUP及其它说明: <strong>IC卡参数下载ulink62域返回0，是终端上送的63域不对</strong><img src="`+k+'" data-fancybox="gallery"></p>',31);function M(O,B,L,G,w,V){const n=c("font");return i(),r("div",null,[v,s("p",null,[a("看pin里面的报错哪个域解析错误，一般增值交易发到传统了，将"),o(n,{color:"red"},{default:e(()=>[a("estpduinfo")]),_:1}),a("表里面对应的1改成2。")]),I,s("p",null,[a("日志返回00，仿真96，可能原因："),N,a("。 查看hsm_key、hsm_tmk是否配置"),o(n,{color:"red"},{default:e(()=>[a("hsm_system中PARAM为ADDR的地址（144.131.254.56:6666）是不是对的。")]),_:1})]),R])}const $=t(S,[["render",M]]);export{U as __pageData,$ as default};
