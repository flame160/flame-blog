import{_ as s,c as a,o as n,V as l}from"./chunks/framework.2c88e6e5.js";const e="/flame-blog/img/platform/szm_259.png",p="/flame-blog/img/platform/szm_259_2.png",d=JSON.parse('{"title":"259号文改造","description":"","frontmatter":{},"headers":[],"relativePath":"platform/szm/number259.md","filePath":"platform/szm/number259.md"}'),o={name:"platform/szm/number259.md"},t=l(`<h1 id="_259号文改造" tabindex="-1">259号文改造 <a class="header-anchor" href="#_259号文改造" aria-label="Permalink to &quot;259号文改造&quot;">​</a></h1><p>在银行卡消费、POS通消费、预授权交易、担保交易组包，需要支持59域上送。如上述交易不支持59域上送，需要进行改造，新增59域上送改造。</p><h2 id="商终密老平台到新一代平台8583报文" tabindex="-1">商终密老平台到新一代平台8583报文 <a class="header-anchor" href="#商终密老平台到新一代平台8583报文" aria-label="Permalink to &quot;商终密老平台到新一代平台8583报文&quot;">​</a></h2><p>商终密老平台到新一代平台8583报文，主要看渠道流水有没有存59域和发送到新一代的报文是否包含59域，没有则透传终端送的59域。</p><p><strong>1. 终端报文转换消费请求实体时,检查实体类PaymentRequest是否有59域字段</strong></p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">PaymentRequest</span><span style="color:#A6ACCD;"> paymentRequest </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PaymentRequest</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">reqJson</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">paymentRequest</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setDeviceSn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getProxyDeviceInfo</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getDevSn</span><span style="color:#89DDFF;">());</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>2. TransferChannel中是否设置59域</strong></p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">StringUtils</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isNotBlank</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSelfDefined059</span><span style="color:#89DDFF;">())){</span></span>
<span class="line"><span style="color:#A6ACCD;">    requestInfo</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setSelfDefined59</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSelfDefined059</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">ChannelResponseInfo</span><span style="color:#A6ACCD;"> responseInfo </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ChannelResponseInfo</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    responseInfo </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">consumeProcess</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">process</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">cupsTrmnl</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">device</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">requestInfo</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">TransferFailedException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>3. ConsumeProcess中packUp是否设置59域</strong></p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">StringUtils</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isNotBlank</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSelfDefined59</span><span style="color:#89DDFF;">()))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    entity</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setSelfDefined59</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSelfDefined59</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="商终密老平台到增值平台json报文" tabindex="-1">商终密老平台到增值平台JSON报文 <a class="header-anchor" href="#商终密老平台到增值平台json报文" aria-label="Permalink to &quot;商终密老平台到增值平台JSON报文&quot;">​</a></h2><p>商终密老平台到增值平台JSON报文，需要改动的地方同到新一代平台。<strong>需要注意的是将打包送给增值服务平台的报文59域转为hex。通过注解实现</strong>。参考渠道号896。</p><img src="`+e+'" data-fancybox="gallery"><img src="'+p+`" data-fancybox="gallery"><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">JSONField</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cust2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#FFCB6B;">serializeUsing</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> HexSerializer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">deserializeUsing</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> HexSerializer</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> selfDefined59</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="商终密新平台itaa-boot到增值服务平台" tabindex="-1">商终密新平台itaa-boot到增值服务平台 <a class="header-anchor" href="#商终密新平台itaa-boot到增值服务平台" aria-label="Permalink to &quot;商终密新平台itaa-boot到增值服务平台&quot;">​</a></h2><p>商终密新平台itaa-boot到增值服务平台则无需改动。</p>`,17),r=[t];function c(D,i,F,y,A,C){return n(),a("div",null,r)}const u=s(o,[["render",c]]);export{d as __pageData,u as default};
